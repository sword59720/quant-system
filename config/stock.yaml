enabled: true
market: CN_STOCK
mode: global_momentum
backtest_mode: production  # production | research

capital_alloc_pct: 0.90

benchmark_symbol: "510300"
defensive_symbol: "518880"

global_model:
  rebalance_days: 5
  momentum_lb: 160
  ma_window: 200
  vol_window: 35
  warmup_min_days: 126
  top_n: 2
  fee: 0.0008
  min_score: 0.04
  risk_on_score_mix: 0.1
  risk_on_score_floor: 0.01
  risk_on_score_power: 0.7
  structural_upgrade:
    enabled: true
    momentum_windows: [20, 60, 180]
    momentum_weights: [0.50, 0.30, 0.20]
    eligibility_require_trend: false
    score_blend: 0.15
    relative_momentum_window: 60
    relative_momentum_weight: 0.00
    asset_trend_ma_window: 80
    breadth_on_threshold: 0.55
    breadth_off_threshold: 0.15
    neutral_alloc_mult: 1.00
    neutral_top_n: 2
    trend_strength_k: 2.0
    trend_alloc_mult_min: 0.85
    trend_alloc_mult_max: 1.15
    breadth_alloc_mult_min: 0.85
    breadth_alloc_mult_max: 1.10
    total_alloc_mult_min: 0.70
    total_alloc_mult_max: 1.05
    phase2_enabled: true
    phase2_vol_short_window: 15
    phase2_vol_long_window: 80
    phase2_vol_calm_ratio: 0.85
    phase2_vol_stress_ratio: 1.10
    phase2_vol_mult_calm: 1.10
    phase2_vol_mult_normal: 1.00
    phase2_vol_mult_stress: 0.85
    phase2_stress_regime_stepdown: 0
    phase2_recovery_enabled: true
    phase2_recovery_window: 180
    phase2_recovery_trigger_drawdown: -0.10
    phase2_recovery_momentum_window: 20
    phase2_recovery_max_mult: 1.10
    phase2_total_mult_min: 0.70
    phase2_total_mult_max: 1.25
    phase2_adaptive_enabled: true
    phase2_adaptive_min_top_n: 1
    phase2_adaptive_max_top_n: 5
    phase2_adaptive_calm_top_n_delta: -1
    phase2_adaptive_stress_top_n_delta: 1
    phase2_adaptive_high_dispersion_threshold: 0.22
    phase2_adaptive_high_dispersion_top_n_delta: -1
    phase2_adaptive_score_power_calm_mult: 1.20
    phase2_adaptive_score_power_stress_mult: 0.85
    signal_strength_enabled: false
    signal_strength_floor: 0.00
    signal_strength_ref: 0.06
    signal_strength_curve: 1.00
    signal_strength_min_alloc_mult: 0.70
    signal_strength_max_alloc_mult: 1.10
  defensive_bypass_single_max: true
  execution_guard:
    enabled: true
    min_rebalance_days: 20
    min_turnover: 0.010
    dynamic_min_turnover:
      enabled: false
      alloc_ref: 0.95
      min_multiplier: 0.50
      max_multiplier: 1.50
      floor: 0.001
      ceil: 0.040
    force_rebalance_on_regime_change: false
  risk_governor:
    enabled: true
    vol_window: 20
    target_daily_vol: 0.011
    min_alloc_mult: 0.45
    max_alloc_mult: 0.95
    dd_window: 100
    dd_trigger: -0.12
    dd_alloc_mult: 0.35
    momentum_window: 40
    momentum_trigger: 0.0
    momentum_alloc_mult: 1.00
  risk_overlay:
    enabled: true
    monitor_file: ./outputs/reports/stock_paper_forward_latest.json
    trigger_excess_20d_vs_alloc: -0.12
    trigger_strategy_drawdown: -0.04
    release_excess_20d_vs_alloc: -0.02
    release_strategy_drawdown: -0.05
    min_defense_days: 3
    sticky_mode: true
  exposure_gate:
    enabled: false
    history_file: ./outputs/reports/stock_paper_forward_history.csv
    lookback_days: [63, 126]
    cpcv:
      n_groups: 5
      test_groups: 2
      embargo_days: 1
      min_fold_days: 12
    thresholds:
      warn_worst_min: -0.10
      risk_worst_min: -0.14
    alloc_caps:
      pass: 0.70
      warn: 0.60
      risk: 0.50

universe:
  - "159915" #创业板ETF
  - "513100" #纳指ETF
  - "518880" #黄金ETF

signal:
  momentum_lookback_days: [20, 60]
  momentum_weights: [0.6, 0.4]
  rebalance_weekday: 1
  top_n: 2

filters:
  min_avg_turnover_cny: 50000000
  suspend_filter: true

validation:
  cpcv:
    enabled: true
    # Window-specific CPCV setup tuned for current history length.
    windows:
      full:
        start_date: null
        n_groups: 8
        test_groups: 3
        embargo_days: 15
        min_fold_days: 80
      oos_2023:
        start_date: "2023-01-03"
        n_groups: 8
        test_groups: 3
        embargo_days: 15
        min_fold_days: 60
    # Suggested gate table (production promotion gate).
    thresholds:
      excess_ann_mean_min: 0.0200
      excess_ann_median_min: 0.0150
      excess_ann_worst_min: -0.0800
      excess_ann_win_rate_min: 0.58
      sharpe_median_min: 0.60
      max_drawdown_worst_min: -0.22
    # Parameter search for N / k / embargo.
    search:
      enabled: true
      n_groups_candidates: [8, 10, 12]
      test_groups_candidates: [2, 3]
      embargo_days_candidates: [10, 15, 20, 30]
      max_results: 12
