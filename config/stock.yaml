enabled: true
market: CN_STOCK
mode: global_momentum
backtest_mode: production  # production | research

capital_alloc_pct: 1.00

benchmark_symbol: "510300"
defensive_symbol: "511010"

global_model:
  rebalance_days: 30
  momentum_lb: 300
  ma_window: 200
  vol_window: 30
  warmup_min_days: 126
  top_n: 5
  fee: 0.0008
  min_score: 0.02
  defensive_bypass_single_max: true
  execution_guard:
    enabled: true
    min_rebalance_days: 30
    min_turnover: 0.05
    dynamic_min_turnover:
      enabled: false
      alloc_ref: 0.70
      min_multiplier: 0.60
      max_multiplier: 1.40
      floor: 0.018
      ceil: 0.050
    force_rebalance_on_regime_change: false
  risk_overlay:
    enabled: true
    monitor_file: ./outputs/reports/stock_paper_forward_latest.json
    trigger_excess_20d_vs_alloc: -0.02
    trigger_strategy_drawdown: -0.12
    release_excess_20d_vs_alloc: 0.01
    release_strategy_drawdown: -0.06
    min_defense_days: 10
    sticky_mode: true
  exposure_gate:
    enabled: false
    history_file: ./outputs/reports/stock_paper_forward_history.csv
    lookback_days: [63, 126]
    cpcv:
      n_groups: 5
      test_groups: 2
      embargo_days: 1
      min_fold_days: 12
    thresholds:
      warn_worst_min: -0.10
      risk_worst_min: -0.14
    alloc_caps:
      pass: 0.70
      warn: 0.60
      risk: 0.50

universe:
  - "510300" #沪深300ETF
  - "510500" #中证500ETF
  - "512100" #中证1000ETF
  - "159915" #创业板ETF
  - "511010" #国债ETF

signal:
  momentum_lookback_days: [20, 60]
  momentum_weights: [0.6, 0.4]
  rebalance_weekday: 1
  top_n: 2

filters:
  min_avg_turnover_cny: 50000000
  suspend_filter: true

validation:
  cpcv:
    enabled: true
    # Window-specific CPCV setup tuned for current history length.
    windows:
      full:
        start_date: null
        n_groups: 8
        test_groups: 3
        embargo_days: 15
        min_fold_days: 80
      oos_2023:
        start_date: "2023-01-03"
        n_groups: 8
        test_groups: 3
        embargo_days: 15
        min_fold_days: 60
    # Suggested gate table (production promotion gate).
    thresholds:
      excess_ann_mean_min: 0.0200
      excess_ann_median_min: 0.0150
      excess_ann_worst_min: -0.0800
      excess_ann_win_rate_min: 0.58
      sharpe_median_min: 0.60
      max_drawdown_worst_min: -0.22
    # Parameter search for N / k / embargo.
    search:
      enabled: true
      n_groups_candidates: [8, 10, 12]
      test_groups_candidates: [2, 3]
      embargo_days_candidates: [10, 15, 20, 30]
      max_results: 12
